<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BA Calculator</title>
    <link rel="apple-touch-icon" href="icon.png">
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="manifest" href="manifest.json">
    <style>
        :root { --bg: #0b1120; --card: #1e293b; --accent: #3b82f6; --text: #ffffff; --gold: #f59e0b; --border: #334155; --danger: #ef4444; --success: #22c55e; }
        body { font-family: -apple-system, system-ui, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; }
        .container { max-width: 500px; margin: auto; position: relative; }
        .version-badge { position: absolute; top: 0; right: 0; font-size: 0.7rem; color: #64748b; font-weight: bold; }
        
        .input-card { background: var(--card); padding: 18px; border-radius: 15px; margin-bottom: 12px; border: 1px solid var(--border); }
        .label-text { font-size: 0.85rem; color: #94a3b8; margin-bottom: 10px; font-weight: bold; text-transform: uppercase; letter-spacing: 0.05em; display: flex; justify-content: space-between; align-items: center; }
        
        .row { display: flex; gap: 8px; align-items: center; }
        input { background: #334155; border: 1px solid #475569; color: white; padding: 12px; border-radius: 10px; font-size: 1.2rem; outline: none; }
        input[type="time"] { flex-grow: 1; color-scheme: dark; }
        input[type="number"] { width: 80px; text-align: center; }
        
        .btn-blue { background: #2563eb; color: white; border: none; padding: 12px 15px; border-radius: 10px; font-weight: bold; cursor: pointer; flex-shrink: 0; }
        .btn-lock { background: var(--card); color: var(--gold); border: 1px solid var(--gold); padding: 12px 15px; border-radius: 10px; font-weight: bold; cursor: pointer; flex-shrink: 0; }
        .btn-lock.locked { background: var(--danger); color: white; border-color: var(--danger); }
        .btn-outline { background: transparent; color: #94a3b8; border: 1px solid #475569; padding: 12px 15px; border-radius: 10px; font-weight: bold; cursor: pointer; }
        
        .collapsible-trigger { cursor: pointer; color: var(--accent); font-size: 0.75rem; text-decoration: underline; }
        #elapsedContainer { display: none; margin-top: 15px; padding-top: 15px; border-top: 1px solid #334155; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { color: #94a3b8; font-size: 0.75rem; text-transform: uppercase; padding: 10px; border-bottom: 1px solid var(--border); }
        td { padding: 14px 8px; text-align: center; border-bottom: 1px solid #1e293b; font-size: 1.1rem; font-weight: 600; }
        
        .tap-col { color: var(--gold); }
        .dur-col { color: #94a3b8; font-weight: 400; font-size: 0.95rem; }
        .tow-col { color: var(--accent); }
        .adj-label { font-size: 0.7rem; color: var(--gold); vertical-align: middle; margin-left: 4px; font-weight: normal; }
        .min-pressure-row td { color: var(--danger) !important; border-bottom: 1px solid var(--danger); }

        .spec-box { margin: 15px 0; padding: 10px; text-align: center; font-size: 0.9rem; border: 1px dashed var(--border); border-radius: 10px; color: #94a3b8; line-height: 1.5; }
        .re-entry-warning { color: var(--danger); font-weight: bold; text-transform: uppercase; display: block; margin-bottom: 5px; }

        .aide-section { margin-top: 30px; border-top: 1px solid var(--border); padding-top: 20px; }
        .abbr-table { background: var(--card); border-radius: 12px; overflow: hidden; width: 100%; margin-top: 10px; border: 1px solid var(--border); }
        .abbr-table td { text-align: left; padding: 10px 12px; font-weight: normal; border-bottom: 1px solid var(--border); font-size: 0.85rem; }
        .abbr-table .code { font-weight: bold; color: var(--accent); width: 30%; border-right: 1px solid var(--border); }

        .manual-btn { display: inline-flex; align-items: center; justify-content: center; background: var(--card); color: var(--accent); border: 1px solid var(--accent); padding: 12px 25px; border-radius: 10px; text-decoration: none; font-weight: bold; font-size: 0.9rem; margin: 20px 0; width: 100%; box-sizing: border-box; }
        .disclaimer { margin-top: 20px; padding: 15px; border-top: 1px solid var(--border); color: #64748b; font-size: 0.7rem; text-align: center; line-height: 1.4; }
    </style>
</head>
<body>

<div class="container">
    <div class="version-badge">V1.02</div>
    <h2>BA Calculator</h2>
    
    <div class="input-card">
        <div class="label-text">
            ENTRY CONTROL TIME 
            <span id="clockStatus" style="font-size: 0.7rem;">CLOCK RUNNING</span>
        </div>
        <div class="row">
            <input type="time" id="entryTime" onchange="manualTimeChange()">
            <button class="btn-blue" onclick="syncWithNow()">NOW</button>
            <button class="btn-lock" id="lockBtn" onclick="toggleLock()">LOCK</button>
        </div>
    </div>

    <div class="input-card">
        <div class="label-text">
            Entry Adjustments
            <span class="collapsible-trigger" id="toggleLink" onclick="toggleElapsed()">SHOW ELAPSED</span>
        </div>
        <div id="elapsedContainer">
            <div class="label-text">Minutes Already Elapsed</div>
            <div class="row">
                <input type="number" id="elapsedMins" value="0" min="0">
                <button class="btn-outline" onclick="resetElapsed()">CLEAR</button>
            </div>
        </div>
    </div>

    <table>
        <thead>
            <tr><th>BAR</th><th>TAP</th><th>DUR</th><th>TOW</th></tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>

    <div class="spec-box">
        <span class="re-entry-warning">160 BAR for re-entry only</span>
        Based on 65 BAR whistle @ 50L/Min rate<br>
        300 BAR X 9L cylinder<br>
        <em>TAP = (Pressure / 2) + 30 BAR</em>
    </div>

    <div class="aide-section">
        <h3>Operational Abbreviations</h3>
        <table class="abbr-table">
            <tbody id="abbrBody"></tbody>
        </table>
    </div>

    <div style="text-align: center;">
        <a href="manual.pdf" target="_blank" class="manual-btn">â“˜ VIEW USER MANUAL (PDF)</a>
    </div>

    <div class="disclaimer">
        <strong>DISCLAIMER:</strong> Personal training use only. No responsibility taken for accuracy or suitability at incidents. May not reflect current policy.
    </div>
</div>

<script>
    const baData = [{bar:300,dur:38},{bar:290,dur:37},{bar:280,dur:35},{bar:270,dur:33},{bar:260,dur:32},{bar:250,dur:30},{bar:240,dur:28},{bar:160,dur:16}];
    
    const abbreviations = [
        ["FFT", "Fire Fighting Team"],["SRT", "Search & Rescue Team"], ["LH / RH", "Left / Right Hand"],
        ["A1, A2...", "Team Alpha 1, 2 etc."], ["B1, B2...", "Team Bravo 1, 2 etc."],["TL", "Team Leader"],
        ["HRJ", "Hose Reel Jet"], ["J", "Main Jet (45/70mm)"],["TIC", "Thermal Image Camera"],["COMMS D3", "Radio Comms - Digital 3"]
        ,["TAP", "Turn Around Pressure"], 
        ["CL", "Casualty Located"], ["RE", "Re-Entry"]
    ];

    let isLocked = false;
    const entryInput = document.getElementById('entryTime');
    const elapsedInput = document.getElementById('elapsedMins');
    const lockBtn = document.getElementById('lockBtn');
    const statusText = document.getElementById('clockStatus');
    const elapsedContainer = document.getElementById('elapsedContainer');
    const toggleLink = document.getElementById('toggleLink');

    function toggleElapsed() {
        const isHidden = elapsedContainer.style.display === "none" || elapsedContainer.style.display === "";
        elapsedContainer.style.display = isHidden ? "block" : "none";
        toggleLink.innerText = isHidden ? "HIDE ELAPSED" : "SHOW ELAPSED";
    }

    function tickClock() {
        if (!isLocked && entryInput.value) {
            let [hrs, mins] = entryInput.value.split(':').map(Number);
            mins++;
            if (mins >= 60) { mins = 0; hrs = (hrs + 1) % 24; }
            entryInput.value = hrs.toString().padStart(2, '0') + ":" + mins.toString().padStart(2, '0');
            renderTable();
        }
    }

    function syncWithNow() {
        const now = new Date();
        entryInput.value = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
        renderTable();
        if (isLocked) toggleLock(); 
    }

    function manualTimeChange() { renderTable(); }

    function toggleLock() {
        isLocked = !isLocked;
        lockBtn.innerText = isLocked ? "UNLOCK" : "LOCK";
        lockBtn.classList.toggle('locked', isLocked);
        statusText.innerText = isLocked ? "CLOCK LOCKED" : "CLOCK RUNNING";
        statusText.style.color = isLocked ? "var(--danger)" : "var(--success)";
    }

    function resetElapsed() { elapsedInput.value = 0; renderTable(); }

    function renderTable() {
        const tbody = document.getElementById('tableBody');
        tbody.innerHTML = '';
        if (!entryInput.value) return;
        const [hrs, mins] = entryInput.value.split(':').map(Number);
        const elapsed = parseInt(elapsedInput.value) || 0;

        baData.forEach(row => {
            const tap = (row.bar / 2) + 30; 
            const calcDur = Math.max(0, row.dur - elapsed);
            const time = new Date();
            time.setHours(hrs, mins + calcDur);
            const towStr = time.getHours().toString().padStart(2, '0') + ":" + time.getMinutes().toString().padStart(2, '0');
            const adj = elapsed > 0 ? '<span class="adj-label">(Adj.)</span>' : '';
            const rowClass = row.bar === 160 ? 'class="min-pressure-row"' : '';
            tbody.innerHTML += `<tr ${rowClass}><td>${row.bar}</td><td class="tap-col">${tap}</td><td class="dur-col">${row.dur}m</td><td class="tow-col">${towStr}${adj}</td></tr>`;
        });
    }

    function loadAbbr() {
        const abbrBody = document.getElementById('abbrBody');
        abbreviations.forEach(item => { 
            abbrBody.innerHTML += `<tr><td class="code">${item[0]}</td><td>${item[1]}</td></tr>`; 
        });
    }

    setInterval(tickClock, 60000);
    elapsedInput.addEventListener('input', renderTable);
    
    window.onload = () => { 
        syncWithNow();
        loadAbbr(); 
        statusText.style.color = "var(--success)";
    };
</script>

</body>
</html>

